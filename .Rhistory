if (saveData){
write.csv(joinedTable,'htnTable_10_24_2019.csv')
write.csv(joinedTableSummarize,'htnTableSummarize_10_24_2019.csv')
}
p<-ggplot(joinedTableCountGroup, aes(x=yearStart,y=nn, group=diverseGroup, color=diverseGroup)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsHispBlack.png", units="in", width=5, height=4, dpi=600)
}
p<-ggplot(joinedTableCount, aes(x=yearStart,y=nn, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsComb.png", units="in", width=5, height=4, dpi=600)
}
joinedTable
head(locations)
head(sponsor,10)
head(calculatedValues,10)
head(baselineMeasurements,10)
baselineMeasurements_tbl
head(interventions)
filtered_table = study_tbl_description %>% select(nct_id,description) %>% filter((nct_id %in% condsMesh$nct_id) | (nct_id %in% condsCond$nct_id) | (nct_id %in% condsTitle$nct_id)) %>% collect()
#filtered_table = study_tbl_description %>% filter((nct_id %in% condsMesh$nct_id) | (nct_id %in% condsCond$nct_id))
#filtered_table = study_tbl_description %>% filter(nct_id %in% condsMesh$nct_id) %>% collect()
#joinedTable %>% filtered_table %>% inner_join(facilities_tabulated,by="nct_id",copy=TRUE)
joinedTable <- join_all(list(filtered_table,facilities_tabulated,sponsor,filter_dates,locations,interventions,calculatedValues),by='nct_id',type="inner")
#joinedTable_tabulated <- joinedTable %>% group_by(nct_id) %>% tally()
#joinedTable <- joinedTable %>% mutate(diverseGroup = as.numeric(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|"))))
joinedTable <- joinedTable %>% mutate(diverseGroup = case_when(str_detect(tolower(description), pattern = paste(c(stringBlack,stringHisp), collapse = "|")) ~ 'diverse',
TRUE ~ 'not diverse'))
joinedTable <- joinedTable %>% mutate(diverse = case_when(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|")) ~ 'black',
str_detect(tolower(description), pattern = paste(stringHisp, collapse = "|"))~  'hispanic',
TRUE ~ 'not diverse'))
joinedTable <- joinedTable %>% mutate(yearStart=year(joinedTable$start_date))
joinedTableCount <- joinedTable %>% group_by(yearStart,diverse) %>% count()
joinedTableCountGroup <- joinedTable %>% group_by(yearStart,diverseGroup) %>% count()
joinedTableSummarize <- joinedTable %>% group_by(diverseGroup,agency_class,phase) %>% count()
if (saveData){
write.csv(joinedTable,'htnTable_10_24_2019.csv')
write.csv(joinedTableSummarize,'htnTableSummarize_10_24_2019.csv')
}
p<-ggplot(joinedTableCountGroup, aes(x=yearStart,y=nn, group=diverseGroup, color=diverseGroup)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsHispBlack.png", units="in", width=5, height=4, dpi=600)
}
p<-ggplot(joinedTableCount, aes(x=yearStart,y=nn, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsComb.png", units="in", width=5, height=4, dpi=600)
}
head(joinedTable)
setwd("C:/Users/david/SharedCode/aact")
joinedTableCountGroup
joinedTableSummarize
joinedTableTotals <- joinedTable %>% group_by(diverseGroup) %>% count()
joinedTableTotals
joinedTableTotals <- joinedTable %>% group_by(diverse) %>% count()
joinedTableTotals
# boolean options for saving
saveData = TRUE
savePlot = TRUE
#########################################
# save data
if (saveData){
write.csv(joinedTable,'htnTable_10_24_2019.csv')
write.csv(joinedTableSummarize,'htnTableSummarize_10_24_2019.csv')
}
# make plots
p<-ggplot(joinedTableCountGroup, aes(x=yearStart,y=nn, group=diverseGroup, color=diverseGroup)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsHispBlack.png", units="in", width=5, height=4, dpi=600)
}
p<-ggplot(joinedTableCount, aes(x=yearStart,y=nn, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsComb.png", units="in", width=5, height=4, dpi=600)
}
p<-ggplot(joinedTableCount, aes(x=yearStart,y=nn, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
# make plots
p<-ggplot(joinedTableCountGroup, aes(x=yearStart,y=nn, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsHispBlack.png", units="in", width=5, height=4, dpi=600)
}
p<-ggplot(joinedTableCount, aes(x=yearStart,y=nn, group=diverseGroup, color=diverseGroup)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsComb.png", units="in", width=5, height=4, dpi=600)
}
# make plots
p<-ggplot(joinedTableCount, aes(x=yearStart,y=nn, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsHispBlack.png", units="in", width=5, height=4, dpi=600)
}
p<-ggplot(joinedTableCountGroup, aes(x=yearStart,y=nn, group=diverseGroup, color=diverseGroup)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsComb.png", units="in", width=5, height=4, dpi=600)
}
joinedTableTotals <- joinedTable %>% group_by(diverse) %>% summarize()
joinedTableTotals
joinedTable
joinedTableTotals <- joinedTable %>% group_by(diverse) %>% tally()
joinedTableTotals
joinedTable %>% tally()
colnames(joinedTable)
joinedTableCount <- joinedTable %>% group_by(yearStart,diverse) %>% tally()
joinedTableCount
#joinedTable %>% filtered_table %>% inner_join(facilities_tabulated,by="nct_id",copy=TRUE)
joinedTable <- join_all(list(filtered_table,facilities_tabulated,sponsor,filter_dates,locations,interventions,calculatedValues),by='nct_id',type="inner")
#joinedTable_tabulated <- joinedTable %>% group_by(nct_id) %>% tally()
#joinedTable <- joinedTable %>% mutate(diverseGroup = as.numeric(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|"))))
joinedTable <- joinedTable %>% mutate(diverseGroup = case_when(str_detect(tolower(description), pattern = paste(c(stringBlack,stringHisp), collapse = "|")) ~ 'diverse',
TRUE ~ 'not diverse'))
joinedTable <- joinedTable %>% mutate(diverse = case_when(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|")) ~ 'black',
str_detect(tolower(description), pattern = paste(stringHisp, collapse = "|"))~  'hispanic',
TRUE ~ 'not diverse'))
joinedTable <- joinedTable %>% mutate(yearStart=year(joinedTable$start_date))
joinedTableCount <- joinedTable %>% group_by(yearStart,diverse) %>% tally()
joinedTableCount
colnames(joinedTable)
tail(joinedTable)
joinedTable$n
facilities_tabulated
facilities <- facilities_tbl %>% select(nct_id,status,name) %>%collect()
facilities_tabulated$numFacilities <- facilities %>% group_by(nct_id) %>% tally()
facilities_tabulated
facilities_tabulated
facilities_tabulated <- facilities %>% group_by(nct_id) %>% add_tally(name='numFacilities')
facilities_tabulated <- facilities %>% group_by(nct_id) %>% add_tally()
facilities_tabulated
facilities_tabulated <- facilities %>% group_by(nct_id) %>% tally()
facilities_tabulated
facilities_tabulated <- facilities %>% group_by(nct_id) %>% tally(name='facilitiesCount')
facilities_tabulated
facilities_tabulated <- facilities %>% group_by(nct_id) %>% tally()
rename(facilities_tabulated,facilitiesCount = n)
savePlot = FALSE
#joinedTable %>% filtered_table %>% inner_join(facilities_tabulated,by="nct_id",copy=TRUE)
joinedTable <- join_all(list(filtered_table,facilities_tabulated,sponsor,filter_dates,locations,interventions,calculatedValues),by='nct_id',type="inner")
#joinedTable_tabulated <- joinedTable %>% group_by(nct_id) %>% tally()
#joinedTable <- joinedTable %>% mutate(diverseGroup = as.numeric(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|"))))
joinedTable <- joinedTable %>% mutate(diverseGroup = case_when(str_detect(tolower(description), pattern = paste(c(stringBlack,stringHisp), collapse = "|")) ~ 'diverse',
TRUE ~ 'not diverse'))
joinedTable <- joinedTable %>% mutate(diverse = case_when(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|")) ~ 'black',
str_detect(tolower(description), pattern = paste(stringHisp, collapse = "|"))~  'hispanic',
TRUE ~ 'not diverse'))
joinedTable <- joinedTable %>% mutate(yearStart=year(joinedTable$start_date))
joinedTableCount <- joinedTable %>% group_by(yearStart,diverse) %>% tally()
rename(joinedTableCount,yearlyCount = n)
joinedTableCountGroup <- joinedTable %>% group_by(yearStart,diverseGroup) %>% count()
rename(joinedTableCountGroup,yearlyCount = n)
# calculate statistics
joinedTableTotals <- joinedTable %>% group_by(diverse) %>% tally()
joinedTableTotals <- joinedTable %>% group_by(diverse) %>% summarize()
joinedTableSummarize <- joinedTable %>% group_by(diverseGroup,agency_class,phase) %>% tally()
#########################################
# save data
if (saveData){
write.csv(joinedTable,'htnTable_10_24_2019.csv')
write.csv(joinedTableSummarize,'htnTableSummarize_10_24_2019.csv')
}
# make plots
p<-ggplot(joinedTableCount, aes(x=yearStart,y=yearlyCount, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsHispBlack.png", units="in", width=5, height=4, dpi=600)
}
p<-ggplot(joinedTableCountGroup, aes(x=yearStart,y=yearlyCount, group=diverseGroup, color=diverseGroup)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsComb.png", units="in", width=5, height=4, dpi=600)
}
joinedTableCount <- joinedTable %>% group_by(yearStart,diverse) %>% tally()
head(joinedTableCount)
colnames(joinedTable)
joinedTable <- join_all(list(filtered_table,facilities_tabulated,sponsor,filter_dates,locations,interventions,calculatedValues),by='nct_id',type="inner")
colnames(joinedTable)
facilities <- facilities_tbl %>% select(nct_id,status,name) %>%collect()
facilities_tabulated <- facilities %>% group_by(nct_id) %>% tally()
rename(facilities_tabulated,facilitiesCount = n)
colnames(filtered_table)
colnames(facilities_tabulated)
facilities_tabulated <- rename(facilities_tabulated,facilitiesCount = n)
colnames(facilities_tabulated)
joinedTable <- join_all(list(filtered_table,facilities_tabulated,sponsor,filter_dates,locations,interventions,calculatedValues),by='nct_id',type="inner")
colnames(joinedTable)
joinedTable <- joinedTable %>% mutate(diverseGroup = case_when(str_detect(tolower(description), pattern = paste(c(stringBlack,stringHisp), collapse = "|")) ~ 'diverse',
TRUE ~ 'not diverse'))
joinedTable <- joinedTable %>% mutate(diverse = case_when(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|")) ~ 'black',
str_detect(tolower(description), pattern = paste(stringHisp, collapse = "|"))~  'hispanic',
TRUE ~ 'not diverse'))
joinedTable <- joinedTable %>% mutate(yearStart=year(joinedTable$start_date))
joinedTableCount <- joinedTable %>% group_by(yearStart,diverse) %>% tally()
joinedTableCount <- rename(joinedTableCount,yearlyCount = n)
joinedTableCountGroup <- joinedTable %>% group_by(yearStart,diverseGroup) %>% count()
joinedTableCountGroup <- rename(joinedTableCountGroup,yearlyCount = n)
# calculate statistics
joinedTableTotals <- joinedTable %>% group_by(diverse) %>% tally()
joinedTableTotals <- joinedTable %>% group_by(diverse) %>% summarize()
joinedTableSummarize <- joinedTable %>% group_by(diverseGroup,agency_class,phase) %>% tally()
#########################################
# save data
if (saveData){
write.csv(joinedTable,'htnTable_10_24_2019.csv')
write.csv(joinedTableSummarize,'htnTableSummarize_10_24_2019.csv')
}
# make plots
p<-ggplot(joinedTableCount, aes(x=yearStart,y=yearlyCount, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsHispBlack.png", units="in", width=5, height=4, dpi=600)
}
p<-ggplot(joinedTableCountGroup, aes(x=yearStart,y=yearlyCount, group=diverseGroup, color=diverseGroup)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsComb.png", units="in", width=5, height=4, dpi=600)
}
joinedTableCount
joinedTable
head(facilities_tabulated)
head(interventions)
interventions %>% group_by(nct_id)
interventions_nest <- interventions %>% nest(data = c(intervention_type))
library(tidyr)
interventions_nest <- interventions %>% nest(data = c(intervention_type))
interventions_nest <- interventions %>% nest(data = intervention_type)
interventions_nest <- interventions %>% group_by(nct_id) %>% nest()
interventions_nest
interventions_nest$data[0]
interventions_nest$data[1]
interventions_nest$data[2]
interventions_nest$data[3]
interventions_nest$data[4]
interventions_nest$data[5]
interventions_nest$data[6]
interventions_nest$data[7]
inverventions <- interventions_nest %>% mutate(Intervention = case_when(str_detect(tolower(data), pattern = paste('procedure')) ~ 'interrv',
TRUE ~ 'drug'))
interventions
interventions_nest <- interventions %>% group_by(nct_id) %>% nest()
inverventions_nest <- interventions_nest %>% mutate(Intervention = case_when(str_detect(tolower(data), pattern = paste('procedure')) ~ 'interrv',
TRUE ~ 'drug'))
interventions_nest
inverventions_nest <- interventions_nest %>% mutate(Intervention = case_when(str_detect(tolower(data), pattern = paste('procedure')) ~ 'interrv',
TRUE ~ 'drug'))
interventions_nest
interventions_nest$tolower(data)
interventions_nest$data
interventions_nest$data[['intervention_type']]
interventions_nest$data[[1]]
interventions_nest$data[['intervention_type']]
interventions = interventions_tbl %>% select(nct_id,intervention_type) %>% collect()
interventions <- interventions %>% group_by(nct_id) %>% summarize(interventions = paste(intervention_type,collapse=", "))
interventions
inverventions <- interventions %>% mutate(interventionType = case_when(str_detect(tolower(interventions), pattern = paste('procedure')) ~ 'procedure',
str_detect(tolower(interventions), pattern = paste('behavioral')) ~ 'behavioral',
str_detect(tolower(interventions), pattern = paste('device')) ~ 'device',
str_detect(tolower(interventions), pattern = paste('biological')) ~ 'biological',
str_detect(tolower(interventions), pattern = paste('drug')) ~ 'drug',
TRUE ~ 'other'))
interventions
interventions %>% mutate(interventionType = case_when(str_detect(tolower(interventions), pattern = paste('procedure')) ~ 'procedure',
str_detect(tolower(interventions), pattern = paste('behavioral')) ~ 'behavioral',
str_detect(tolower(interventions), pattern = paste('device')) ~ 'device',
str_detect(tolower(interventions), pattern = paste('biological')) ~ 'biological',
str_detect(tolower(interventions), pattern = paste('drug')) ~ 'drug',
TRUE ~ 'other'))
inverventions <- interventions %>% mutate(interventionType = case_when(str_detect(tolower(interventions), pattern = paste('procedure')) ~ 'procedure',
str_detect(tolower(interventions), pattern = paste('behavioral')) ~ 'behavioral',
str_detect(tolower(interventions), pattern = paste('device')) ~ 'device',
str_detect(tolower(interventions), pattern = paste('biological')) ~ 'biological',
str_detect(tolower(interventions), pattern = paste('drug')) ~ 'drug',
TRUE ~ 'other'))
interventions
colnames(joinedTable)
interventions %>% mutate(interventionType = case_when(str_detect(tolower(interventions), pattern = paste('procedure')) ~ 'procedure',
str_detect(tolower(interventions), pattern = paste('behavioral')) ~ 'behavioral',
str_detect(tolower(interventions), pattern = paste('device')) ~ 'device',
str_detect(tolower(interventions), pattern = paste('biological')) ~ 'biological',
str_detect(tolower(interventions), pattern = paste('drug')) ~ 'drug',
TRUE ~ 'other'))
interventions = interventions_tbl %>% select(nct_id,intervention_type) %>% collect()
interventions <- interventions %>% group_by(nct_id) %>% summarize(intervention_comb = paste(intervention_type,collapse=", "))
inverventions <- interventions %>% mutate(interventionType = case_when(str_detect(tolower(intervention_comb), pattern = paste('procedure')) ~ 'procedure',
str_detect(tolower(intervention_comb), pattern = paste('behavioral')) ~ 'behavioral',
str_detect(tolower(intervention_comb), pattern = paste('device')) ~ 'device',
str_detect(tolower(intervention_comb), pattern = paste('biological')) ~ 'biological',
str_detect(tolower(intervention_comb), pattern = paste('drug')) ~ 'drug',
TRUE ~ 'other'))
interventions
inverventionsNew <- interventions %>% mutate(interventionType = case_when(str_detect(tolower(intervention_comb), pattern = paste('procedure')) ~ 'procedure',
str_detect(tolower(intervention_comb), pattern = paste('behavioral')) ~ 'behavioral',
str_detect(tolower(intervention_comb), pattern = paste('device')) ~ 'device',
str_detect(tolower(intervention_comb), pattern = paste('biological')) ~ 'biological',
str_detect(tolower(intervention_comb), pattern = paste('drug')) ~ 'drug',
TRUE ~ 'other'))
interventions %>% mutate(interventionType = case_when(str_detect(tolower(intervention_comb), pattern = paste('procedure')) ~ 'procedure',
str_detect(tolower(intervention_comb), pattern = paste('behavioral')) ~ 'behavioral',
str_detect(tolower(intervention_comb), pattern = paste('device')) ~ 'device',
str_detect(tolower(intervention_comb), pattern = paste('biological')) ~ 'biological',
str_detect(tolower(intervention_comb), pattern = paste('drug')) ~ 'drug',
TRUE ~ 'other'))
inverventions <- interventions %>% mutate(interventionType = case_when(str_detect(tolower(intervention_comb), pattern = paste('procedure')) ~ 'procedure',
str_detect(tolower(intervention_comb), pattern = paste('behavioral')) ~ 'behavioral',
str_detect(tolower(intervention_comb), pattern = paste('device')) ~ 'device',
str_detect(tolower(intervention_comb), pattern = paste('biological')) ~ 'biological',
str_detect(tolower(intervention_comb), pattern = paste('drug')) ~ 'drug',
TRUE ~ 'other'))
View(inverventions)
View(inverventions)
colnames(interventions)
View(inverventionsNew)
interventionsNew
ls
ls()
interventions <- interventions %>% group_by(nct_id) %>% summarize(intervention_comb = paste(intervention_type,collapse=", ")) %>% mutate(interventionType = case_when(str_detect(tolower(intervention_comb), pattern = paste('procedure')) ~ 'procedure',
str_detect(tolower(intervention_comb), pattern = paste('behavioral')) ~ 'behavioral',
str_detect(tolower(intervention_comb), pattern = paste('device')) ~ 'device',
str_detect(tolower(intervention_comb), pattern = paste('biological')) ~ 'biological',
str_detect(tolower(intervention_comb), pattern = paste('drug')) ~ 'drug',
TRUE ~ 'other'))
interventions <- interventions %>% group_by(nct_id) %>% summarize(intervention_comb = paste(intervention_type,collapse=", "))
inverventions <- interventions %>% mutate(interventionType = case_when(str_detect(tolower(intervention_comb), pattern = paste('procedure')) ~ 'procedure',
str_detect(tolower(intervention_comb), pattern = paste('behavioral')) ~ 'behavioral',
str_detect(tolower(intervention_comb), pattern = paste('device')) ~ 'device',
str_detect(tolower(intervention_comb), pattern = paste('biological')) ~ 'biological',
str_detect(tolower(intervention_comb), pattern = paste('drug')) ~ 'drug',
TRUE ~ 'other'))
interventions
joinedTable <- join_all(list(filtered_table,facilities_tabulated,sponsor,filter_dates,locations,interventions,calculatedValues),by='nct_id',type="inner")
colnames(joinedTable)
inverventions <<- interventions %>% mutate(interventionType = case_when(str_detect(tolower(intervention_comb), pattern = paste('procedure')) ~ 'procedure',
str_detect(tolower(intervention_comb), pattern = paste('behavioral')) ~ 'behavioral',
str_detect(tolower(intervention_comb), pattern = paste('device')) ~ 'device',
str_detect(tolower(intervention_comb), pattern = paste('biological')) ~ 'biological',
str_detect(tolower(intervention_comb), pattern = paste('drug')) ~ 'drug',
TRUE ~ 'other'))
interventions
interventions
a = interventions %>% mutate(interventionType = case_when(str_detect(tolower(intervention_comb), pattern = paste('procedure')) ~ 'procedure',
str_detect(tolower(intervention_comb), pattern = paste('behavioral')) ~ 'behavioral',
str_detect(tolower(intervention_comb), pattern = paste('device')) ~ 'device',
str_detect(tolower(intervention_comb), pattern = paste('biological')) ~ 'biological',
str_detect(tolower(intervention_comb), pattern = paste('drug')) ~ 'drug',
TRUE ~ 'other'))
a
interventionTrial = interventions %>% mutate(interventionType = case_when(str_detect(tolower(intervention_comb), pattern = paste('procedure')) ~ 'procedure',
str_detect(tolower(intervention_comb), pattern = paste('behavioral')) ~ 'behavioral',
str_detect(tolower(intervention_comb), pattern = paste('device')) ~ 'device',
str_detect(tolower(intervention_comb), pattern = paste('biological')) ~ 'biological',
str_detect(tolower(intervention_comb), pattern = paste('drug')) ~ 'drug',
TRUE ~ 'other'))
interventionTrial
#joinedTable %>% filtered_table %>% inner_join(facilities_tabulated,by="nct_id",copy=TRUE)
joinedTable <- join_all(list(filtered_table,facilities_tabulated,sponsor,filter_dates,locations,interventionTrial,calculatedValues),by='nct_id',type="inner")
#joinedTable_tabulated <- joinedTable %>% group_by(nct_id) %>% tally()
#joinedTable <- joinedTable %>% mutate(diverseGroup = as.numeric(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|"))))
joinedTable <- joinedTable %>% mutate(diverseGroup = case_when(str_detect(tolower(description), pattern = paste(c(stringBlack,stringHisp), collapse = "|")) ~ 'diverse',
TRUE ~ 'not diverse'))
joinedTable <- joinedTable %>% mutate(diverse = case_when(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|")) ~ 'black',
str_detect(tolower(description), pattern = paste(stringHisp, collapse = "|"))~  'hispanic',
TRUE ~ 'not diverse'))
joinedTable <- joinedTable %>% mutate(yearStart=year(joinedTable$start_date))
joinedTableCount <- joinedTable %>% group_by(yearStart,diverse) %>% tally()
joinedTableCount <- rename(joinedTableCount,yearlyCount = n)
joinedTableCountGroup <- joinedTable %>% group_by(yearStart,diverseGroup) %>% count()
joinedTableCountGroup <- rename(joinedTableCountGroup,yearlyCount = n)
# calculate statistics
joinedTableTotals <- joinedTable %>% group_by(diverse) %>% tally()
joinedTableTotals <- joinedTable %>% group_by(diverse) %>% summarize()
joinedTableSummarize <- joinedTable %>% group_by(diverseGroup,agency_class,phase) %>% tally()
#########################################
# save data
if (saveData){
write.csv(joinedTable,'htnTable_10_24_2019.csv')
write.csv(joinedTableSummarize,'htnTableSummarize_10_24_2019.csv')
}
# make plots
p<-ggplot(joinedTableCount, aes(x=yearStart,y=yearlyCount, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsHispBlack.png", units="in", width=5, height=4, dpi=600)
}
p<-ggplot(joinedTableCountGroup, aes(x=yearStart,y=yearlyCount, group=diverseGroup, color=diverseGroup)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsComb.png", units="in", width=5, height=4, dpi=600)
}
savePlot = 1
# make plots
p<-ggplot(joinedTableCount, aes(x=yearStart,y=yearlyCount, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsHispBlack.png", units="in", width=5, height=4, dpi=600)
}
p<-ggplot(joinedTableCountGroup, aes(x=yearStart,y=yearlyCount, group=diverseGroup, color=diverseGroup)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
if (savePlot){
ggsave("trialsByYearConditionsComb.png", units="in", width=5, height=4, dpi=600)
}
joinedTableTotals <- joinedTable %>% group_by(diverse) %>% summarize()
joinedTableTotals
joinedTableTotals
joinedTableTotals <- joinedTable %>% group_by(diverse) %>% tally()
joinedTableTotals
joinedTableTotals <- joinedTable %>% group_by(diverse) %>% summarize(n())
joinedTableTotals
joinedTableSummarize <- joinedTable %>% group_by(diverse,interventionType) %>% tally()
joinedTableSummarize
facilities_tabulated <- facilities_tabulated %>% mutate(multisite = ifelse(facilitiesCount>1))
facilities_tabulated <- facilities_tabulated %>% mutate(multisite = ifelse(facilitiesCount>1,TRUE,FALSE))
facilities_tabulated
