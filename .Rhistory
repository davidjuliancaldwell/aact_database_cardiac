library(lubridate)
strings = c('black','asian','african american')
startDate = as.Date("2009-01-01")
termsSearch = c('Hypertension','Blood pressure')
drv <- dbDriver('PostgreSQL')
con <- dbConnect(drv, dbname="aact",host="aact-db.ctti-clinicaltrials.org", port=5432, user="djcald", password="DD968radford")
study_tbl = tbl(src=con,'studies')
study_tbl %>% mutate(start_year = year(startDate))
filter_dates <- study_tbl %>% filter(start_date >= startDate)
study_tbl_conditions = tbl(src=con, 'browse_conditions')
conds <- study_tbl_conditions %>% filter(mesh_term %in% termsSearch) %>% collect()
study_tbl_description = tbl(src=con, 'detailed_descriptions')
filtered_table = study_tbl_description %>% filter(nct_id %in% conds$nct_id) %>% collect()
filtered_table_description = filtered_table %>% select(description) %>% collect()
filteredNum = filtered_table %>% filter(str_detect(tolower(description), pattern = paste(strings, collapse = "|"))) %>% collect()
joinedTable <- filter_dates %>% inner_join(filteredNum, by = "nct_id",copy = TRUE)
study_tbl %>% mutate(start_year = year(startDate))
filteredNumNotDiverse = filtered_table %>% filter(nct_id !%in% filteredNum$ncd_id)
filteredNumNotDiverse = filtered_table %>% filter(nct_id Negate(`%in%`) filteredNum$ncd_id)
`%nin%` = Negate(`%in%`)
filteredNumNotDiverse = filtered_table %>% filter(nct_id %nin% filteredNum$ncd_id)
filteredNumNotDiverse = filtered_table %>% filter(nct_id %nin% filteredNum$nct_id)
joinedTable
head(joinedTable,2)
yearly_counts <- joinedTable %>%
group_by(year(start_year)) %>%
summarise(count=n())
yearly_counts
joinedTable
View(joinedTable)
yearly_counts <- joinedTable %>%
group_by(year(start_date)) %>%
summarise(count=n())
yearly_counts
filtered_table
year(joinedTable$start_date)
year(as.Date(joinedTable$start_date))
joinedTable %>% mutate(yearStart = year(startDate))
yearly_counts <- joinedTable %>%
group_by(start_date) %>%
summarise(count=n())
yearly_counts
yearly_counts <- joinedTable %>%
group_by(year(start_date)) %>%
summarise(count=n())
yearly_counts
yearly_counts <- pull(joinedTable,startDate) %>%  summarise(count=n())
a <-pull(joinedTable,startDate)
yearly_counts <- pull(joinedTable,start_date) %>%  summarise(count=n())
yearly_counts <- pull(joinedTable,year(start_date)) %>%  summarise(count=n())
yearly_counts <- pull(joinedTable,start_date)
yearly_counts
yearly_counts <- pull(joinedTable,start_date,nct_id)
yearly_counts <- select(joinedTable,start_date,nct_id)
yearly_counts
library(RPostgreSQL)
library(dplyr)
library(stringr)
library(lubridate)
strings = c('black','asian','african american')
startDate = as.Date("2009-01-01")
termsSearch = c('Hypertension','Blood pressure')
`%nin%` = Negate(`%in%`)
drv <- dbDriver('PostgreSQL')
con <- dbConnect(drv, dbname="aact",host="aact-db.ctti-clinicaltrials.org", port=5432, user="djcald", password="DD968radford")
study_tbl = tbl(src=con,'studies')
study_tbl %>% mutate(start_year = year(startDate))
filter_dates <- study_tbl %>% filter(start_date >= startDate)
study_tbl_conditions = tbl(src=con, 'browse_conditions')
conds <- study_tbl_conditions %>% filter(mesh_term %in% termsSearch) %>% collect()
study_tbl_description = tbl(src=con, 'detailed_descriptions')
filtered_table = study_tbl_description %>% filter(nct_id %in% conds$nct_id) %>% collect()
filtered_table_description = filtered_table %>% select(description) %>% collect()
filteredNum = filtered_table %>% filter(str_detect(tolower(description), pattern = paste(strings, collapse = "|"))) %>% collect()
filteredNumNotDiverse = filtered_table %>% filter(nct_id %nin% filteredNum$nct_id)
joinedTable <- filter_dates %>% inner_join(filteredNum, by = "nct_id",copy = TRUE)
library(RPostgreSQL)
library(dplyr)
library(stringr)
library(lubridate)
strings = c('black','asian','african american')
startDate = as.Date("2009-01-01")
termsSearch = c('Hypertension','Blood pressure')
`%nin%` = Negate(`%in%`)
drv <- dbDriver('PostgreSQL')
con <- dbConnect(drv, dbname="aact",host="aact-db.ctti-clinicaltrials.org", port=5432, user="djcald", password="DD968radford")
study_tbl = tbl(src=con,'studies')
filter_dates <- study_tbl %>% filter(start_date >= startDate)
study_tbl_conditions = tbl(src=con, 'browse_conditions')
conds <- study_tbl_conditions %>% filter(mesh_term %in% termsSearch) %>% collect()
study_tbl_description = tbl(src=con, 'detailed_descriptions')
filtered_table = study_tbl_description %>% filter(nct_id %in% conds$nct_id) %>% collect()
filtered_table_description = filtered_table %>% select(description) %>% collect()
filteredNum = filtered_table %>% filter(str_detect(tolower(description), pattern = paste(strings, collapse = "|"))) %>% collect()
filteredNumNotDiverse = filtered_table %>% filter(nct_id %nin% filteredNum$nct_id)
joinedTable <- filter_dates %>% inner_join(filteredNum, by = "nct_id",copy = TRUE)
yearly_counts <- joinedTable %>%
group_by(year(start_date)) %>%
summarise(count=n())
joinedTableNotDiverse <- filter_dates %>% inner_join(filteredNumNotDiverse, by = "nct_id",copy = TRUE)
yearly_counts <- year(pull(joinedTable,start_date))
yearly_counts_NotDiverse <-> year(pull(joinedTableNotDiverse,start_date))
yearly_counts <- year(pull(joinedTable,start_date))
yearly_counts_NotDiverse <- year(pull(joinedTableNotDiverse,start_date))
library(RPostgreSQL)
library(dplyr)
library(stringr)
library(lubridate)
library(ggplot2)
strings = c('black','asian','african american','hispanic')
startDate = as.Date("2009-01-01")
termsSearchMesh = c('Hypertension','Blood pressure','Prehypertension')
termsSearchCondTitle = c('blood pressure','diastolic','systolic','hypertension')
countriesList = c("United States")
`%nin%` = Negate(`%in%`)
drv <- dbDriver('PostgreSQL')
con <- dbConnect(drv, dbname="aact",host="aact-db.ctti-clinicaltrials.org", port=5432, user="djcald", password="DD968radford")
study_tbl = tbl(src=con,'studies')
filter_dates <- study_tbl %>% filter(start_date >= startDate)
location_tbl = tbl(src=con,'countries')
locations <- location_tbl %>% filter(name %in% countriesList)
study_tbl_browse_conditions = tbl(src=con, 'browse_conditions')
condsMesh <- study_tbl_browse_conditions %>% filter(tolower(mesh_term) %in% termsSearchMesh)
study_tbl_conditions = tbl(src=con, 'conditions')
condsCond <- study_tbl_conditions %>% filter(downcase_name %in% termsSearchCond)
condsCOnd
condsCond
condsCond <- study_tbl_conditions %>% filter(downcase_name %in% termsSearchCondTitle)
condsCond
condsTitle <- study_tbl %>% filter(official_title %in% termsSearchTitle)
condsTitle
condsTitle <- study_tbl %>% filter(official_title %in% termsSearchCondTitle)
condsTitle
head(condsTitle,5)
condsTitle <- study_tbl %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")))
condsTitle
strings
filtered_table_description = filtered_table %>% select(description)
filteredNum = filtered_table %>% filter(str_detect(tolower(description), pattern = paste(strings, collapse = "|")))
condsTitle <- study_tbl %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")))
condsTitle
head(study_tbl$official_title,5)
study_Tbl
study_tbl
library(RPostgreSQL)
library(dplyr)
library(stringr)
library(lubridate)
library(ggplot2)
strings = c('black','asian','african american','hispanic')
startDate = as.Date("2009-01-01")
termsSearchMesh = c('hypertension','blood pressure','prehypertension')
termsSearchCondTitle = c('blood pressure','diastolic','systolic','hypertension')
countriesList = c("United States")
`%nin%` = Negate(`%in%`)
paste(termsSearchCondTitle,collapse="|"))
paste(termsSearchCondTitle,collapse="|")
official_title <- c("the blood pressure was fine")
str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")
)
condsTitle <- study_tbl %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")))
condsTitle
condsTitle <- study_tbl %>% filter(str_detect(tolower(official_title),pattern = str_flatten(termsSearchCondTitle,collapse="|")))
condsTitle
condsTitle <- study_tbl %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")))
condsTitle
termsSearchCondTitle = c('pressure','diastolic','systolic','hypertension')
condsTitle <- study_tbl %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")))
condsTitle
study_tbl$official_title
view(study_tbl)
condMesh
condsMesh
condsCond
condsMesh %>% collect()
library(RPostgreSQL)
library(dplyr)
library(stringr)
library(lubridate)
library(ggplot2)
strings = c('black','asian','african american','hispanic')
startDate = as.Date("2009-01-01")
termsSearchMesh = c('hypertension','blood pressure','prehypertension')
termsSearchCondTitle = c('blood pressure','diastolic','systolic','hypertension')
countriesList = c("United States")
`%nin%` = Negate(`%in%`)
drv <- dbDriver('PostgreSQL')
con <- dbConnect(drv, dbname="aact",host="aact-db.ctti-clinicaltrials.org", port=5432, user="djcald", password="DD968radford")
study_tbl = tbl(src=con,'studies')
filter_dates <- study_tbl %>% filter(start_date >= startDate)
location_tbl = tbl(src=con,'countries')
locations <- location_tbl %>% filter(name %in% countriesList)
study_tbl_browse_conditions = tbl(src=con, 'browse_conditions')
condsMesh <- study_tbl_browse_conditions %>% filter(tolower(mesh_term) %in% termsSearchMesh)
study_tbl_conditions = tbl(src=con, 'conditions')
condsCond <- study_tbl_conditions %>% filter(downcase_name %in% termsSearchCondTitle)
condsMesh %>% collect()
condsCond %>% collect()
filter_datse
condsTitle <- study_tbl %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")))
condsTitle
filter_dates <- study_tbl %>% filter((start_date >= startDate) & filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|"))))
filter_dates
condsTitle <- study_tbl %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|"))) %>% collapse()
condsTitle <- study_tbl %>% filter(str_detect(tolower(official_title),pattern = str_flatten(termsSearchCondTitle,collapse="|"))) %>% collapse()
filtered_table = study_tbl_description %>% filter((nct_id %in% condsMesh$nct_id) | (nct_id %in% condsCond$nct_id))
study_tbl_description = tbl(src=con, 'detailed_descriptions')
filtered_table = study_tbl_description %>% filter((nct_id %in% condsMesh$nct_id) | (nct_id %in% condsCond$nct_id))
filtered_table
filtered_table = study_tbl_description %>% filter((nct_id %in% condsMesh$nct_id))
filtered_table
study_tbl_description
condsMesh
filtered_table = study_tbl_description %>% filter((nct_id %in% condsMesh$nct_id)) %>% collect()
filtered_table = study_tbl_description %>% filter(nct_id %in% condsMesh$nct_id) %>% collect()
library(RPostgreSQL)
library(dplyr)
library(stringr)
library(lubridate)
library(ggplot2)
strings = c('black','asian','african american','hispanic')
startDate = as.Date("2009-01-01")
termsSearchMesh = c('hypertension','blood pressure','prehypertension')
termsSearchCondTitle = c('blood pressure','diastolic','systolic','hypertension')
countriesList = c("United States")
`%nin%` = Negate(`%in%`)
drv <- dbDriver('PostgreSQL')
con <- dbConnect(drv, dbname="aact",host="aact-db.ctti-clinicaltrials.org", port=5432, user="djcald", password="DD968radford")
study_tbl = tbl(src=con,'studies')
filter_dates <- study_tbl %>% filter(start_date >= startDate)
location_tbl = tbl(src=con,'countries')
locations <- location_tbl %>% filter(name %in% countriesList) %>% collect()
study_tbl_browse_conditions = tbl(src=con, 'browse_conditions')
condsMesh <- study_tbl_browse_conditions %>% filter(tolower(mesh_term) %in% termsSearchMesh) %>% collect()
study_tbl_conditions = tbl(src=con, 'conditions')
condsCond <- study_tbl_conditions %>% filter(downcase_name %in% termsSearchCondTitle) %>% collect()
study_tbl_description = tbl(src=con, 'detailed_descriptions')
condsCOnd
condsMesh
study_tbl_description
filtered_table = study_tbl_description %>% filter(nct_id %in% condsMesh$nct_id) %>% collect()
condsTitle <- study_tbl %>% filter(str_detect(tolower(official_title),pattern = str_flatten(termsSearchCondTitle,collapse="|")))
condsTitle
condsTitle <- study_tbl %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")))
condsTitle
filter_dates <- study_tbl %>% filter(start_date >= startDate) %>% select(start_date,official_title,description)
filter_dates
condsTitle <- filter_dates %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")))
filter_dates <- study_tbl %>% filter(start_date >= startDate)
condsTitle <- filter_dates %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")))
condsTitle
filter_dates <- study_tbl %>% filter(start_date >= startDate) %>% select(official_title,start_date) %>% collect()
filter_Dates
filter_dates
condsTitle <- filter_dates %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")))
condsTitle
study_tbl_description = tbl(src=con, 'detailed_descriptions')
filtered_table = study_tbl_description %>% filter((nct_id %in% condsMesh$nct_id) | (nct_id %in% condsCond$nct_id) | (nct_id %in% condsTitle$nct_id)) %>% collect()
#filtered_table = study_tbl_description %>% filter((nct_id %in% condsMesh$nct_id) | (nct_id %in% condsCond$nct_id))
#filtered_table = study_tbl_description %>% filter(nct_id %in% condsMesh$nct_id) %>% collect()
study_tbl_description
filter_dates <- study_tbl %>% filter(start_date >= startDate) %>% select(official_title,start_date,nct_id) %>% collect()
filter_dates
filtered_table = study_tbl_description %>% filter((nct_id %in% condsMesh$nct_id) | (nct_id %in% condsCond$nct_id) | (nct_id %in% condsTitle$nct_id)) %>% collect()
condsTitle
condsTitle <- filter_dates %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")))
filtered_table = study_tbl_description %>% filter((nct_id %in% condsMesh$nct_id) | (nct_id %in% condsCond$nct_id) | (nct_id %in% condsTitle$nct_id)) %>% collect()
filtered_table
library(RPostgreSQL)
library(dplyr)
library(stringr)
library(lubridate)
library(ggplot2)
strings = c('black','asian','african american','hispanic')
startDate = as.Date("2009-01-01")
termsSearchMesh = c('hypertension','blood pressure','prehypertension')
termsSearchCondTitle = c('blood pressure','diastolic','systolic','hypertension')
countriesList = c("United States")
`%nin%` = Negate(`%in%`)
drv <- dbDriver('PostgreSQL')
con <- dbConnect(drv, dbname="aact",host="aact-db.ctti-clinicaltrials.org", port=5432, user="djcald", password="DD968radford")
study_tbl = tbl(src=con,'studies')
filter_dates <- study_tbl %>% filter(start_date >= startDate) %>% select(official_title,start_date,nct_id,phase) %>% collect()
location_tbl = tbl(src=con,'countries')
locations <- location_tbl %>% filter(name %in% countriesList) %>% collect()
facilities_tbl = tbl(src=con,'countries')
facilities <- facilities_tbl %>% collect()
facilities
facilities_tbl = tbl(src=con,'facilities')
facilities <- facilities_tbl %>% collect()
facilities
facilities_tbl
facilities_tabulated <- facilities %>% group_by(nct_id) %>% tally()
facilities_tabulated
histogram(facilities_tabulated)
hist(facilities_tabulated)
library(RPostgreSQL)
library(dplyr)
library(stringr)
library(lubridate)
library(ggplot2)
strings = c('black','asian','african american','hispanic')
startDate = as.Date("2009-01-01")
termsSearchMesh = c('hypertension','blood pressure','prehypertension')
termsSearchCondTitle = c('blood pressure','diastolic','systolic','hypertension')
countriesList = c("United States")
`%nin%` = Negate(`%in%`)
drv <- dbDriver('PostgreSQL')
con <- dbConnect(drv, dbname="aact",host="aact-db.ctti-clinicaltrials.org", port=5432, user="djcald", password="DD968radford")
study_tbl = tbl(src=con,'studies')
filter_dates <- study_tbl %>% select(official_title,start_date,nct_id,phase) %>% filter(start_date >= startDate)  %>% collect()
sponsor_tbl = tbl(src=con,'sponsors')
sponsor <- sponsor_tbl %>% select(ncd_id,agency_class) %>% filter(name %in% countriesList) %>% collect()
sponsor <- sponsor_tbl %>% select(nct_id,agency_class) %>% filter(name %in% countriesList) %>% collect()
sponsor <- sponsor_tbl %>% select(nct_id,agency_class) %>% collect()
sponsor
study_tbl = tbl(src=con,'studies')
filter_dates <- study_tbl %>% select(official_title,start_date,nct_id,phase) %>% filter(start_date >= startDate)  %>% copy()
filter_dates <- study_tbl %>% select(official_title,start_date,nct_id,phase) %>% filter(start_date >= startDate)  %>% compute()
sponsor <- sponsor_tbl %>% select(nct_id,agency_class) %>% compute()
sponsor
library(RPostgreSQL)
library(dplyr)
library(stringr)
library(lubridate)
library(ggplot2)
strings = c('black','asian','african american','hispanic')
startDate = as.Date("2009-01-01")
termsSearchMesh = c('hypertension','blood pressure','prehypertension')
termsSearchCondTitle = c('blood pressure','diastolic','systolic','hypertension')
countriesList = c("United States")
`%nin%` = Negate(`%in%`)
drv <- dbDriver('PostgreSQL')
con <- dbConnect(drv, dbname="aact",host="aact-db.ctti-clinicaltrials.org", port=5432, user="djcald", password="DD968radford")
study_tbl = tbl(src=con,'studies')
filter_dates <- study_tbl %>% select(official_title,start_date,nct_id,phase) %>% filter(start_date >= startDate)  %>% collect()
location_tbl = tbl(src=con,'countries')
locations <- location_tbl %>% select(nct_id,name) %>% filter(name %in% countriesList) %>% collect()
sponsor_tbl = tbl(src=con,'sponsors')
sponsor <- sponsor_tbl %>% select(nct_id,agency_class) %>% collect()
facilities_tbl = tbl(src=con,'facilities')
facilities <- facilities_tbl %>% select(nct_id,status,name) %>%collect()
facilities_tabulated <- facilities %>% group_by(nct_id) %>% tally()
study_tbl_browse_conditions = tbl(src=con, 'browse_conditions')
condsMesh <- study_tbl_browse_conditions %>% select(nct_id,mesh_term) %>% filter(tolower(mesh_term) %in% termsSearchMesh) %>% collect()
study_tbl_conditions = tbl(src=con, 'conditions')
condsCond <- study_tbl_conditions %>% select(nct_id,downcase_name) %>%filter(downcase_name %in% termsSearchCondTitle) %>% collect()
condsTitle <- filter_dates %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")))
study_tbl_description = tbl(src=con, 'detailed_descriptions')
filtered_table = study_tbl_description %>% select(nct_id,description) %>% filter((nct_id %in% condsMesh$nct_id) | (nct_id %in% condsCond$nct_id) | (nct_id %in% condsTitle$nct_id)) %>% collect()
#filtered_table = study_tbl_description %>% filter((nct_id %in% condsMesh$nct_id) | (nct_id %in% condsCond$nct_id))
#filtered_table = study_tbl_description %>% filter(nct_id %in% condsMesh$nct_id) %>% collect()
filtered_tab;e
filtered_table
join_all
library(plyr)
library(dplyr)
library(dplyr)
joinedTable %>% join_all(list(filtered_table,facilities_tabulated,sponsor,filter_dates,locations),by=nct_id)
joinedTable <- join_all(list(filtered_table,facilities_tabulated,sponsor,filter_dates,locations),by='nct_id',type="inner")
joinedTable
rm(condsCond,condsMesh)
rm(drv)
rm(facilitis)
rm(facilities)
library(RPostgreSQL)
library(plyr)
library(dplyr)
library(stringr)
library(lubridate)
library(ggplot2)
strings = c('black','asian','african american','hispanic')
startDate = as.Date("2009-01-01")
termsSearchMesh = c('hypertension','blood pressure','prehypertension')
termsSearchCondTitle = c('blood pressure','diastolic','systolic','hypertension')
countriesList = c("United States")
`%nin%` = Negate(`%in%`)
drv <- dbDriver('PostgreSQL')
con <- dbConnect(drv, dbname="aact",host="aact-db.ctti-clinicaltrials.org", port=5432, user="djcald", password="DD968radford")
study_tbl = tbl(src=con,'studies')
filter_dates <- study_tbl %>% select(official_title,start_date,nct_id,phase) %>% filter(start_date >= startDate)  %>% collect()
location_tbl = tbl(src=con,'countries')
locations <- location_tbl %>% select(nct_id,name) %>% filter(name %in% countriesList) %>% collect()
sponsor_tbl = tbl(src=con,'sponsors')
sponsor <- sponsor_tbl %>% select(nct_id,agency_class) %>% collect()
facilities_tbl = tbl(src=con,'facilities')
facilities <- facilities_tbl %>% select(nct_id,status,name) %>%collect()
facilities_tabulated <- facilities %>% group_by(nct_id) %>% tally()
study_tbl_browse_conditions = tbl(src=con, 'browse_conditions')
condsMesh <- study_tbl_browse_conditions %>% select(nct_id,mesh_term) %>% filter(tolower(mesh_term) %in% termsSearchMesh) %>% collect()
study_tbl_conditions = tbl(src=con, 'conditions')
condsCond <- study_tbl_conditions %>% select(nct_id,downcase_name) %>%filter(downcase_name %in% termsSearchCondTitle) %>% collect()
condsTitle <- filter_dates %>% filter(str_detect(tolower(official_title),pattern = paste(termsSearchCondTitle,collapse="|")))
study_tbl_description = tbl(src=con, 'detailed_descriptions')
filtered_table = study_tbl_description %>% select(nct_id,description) %>% filter((nct_id %in% condsMesh$nct_id) | (nct_id %in% condsCond$nct_id) | (nct_id %in% condsTitle$nct_id)) %>% collect()
#filtered_table = study_tbl_description %>% filter((nct_id %in% condsMesh$nct_id) | (nct_id %in% condsCond$nct_id))
#filtered_table = study_tbl_description %>% filter(nct_id %in% condsMesh$nct_id) %>% collect()
#joinedTable %>% filtered_table %>% inner_join(facilities_tabulated,by="nct_id",copy=TRUE)
joinedTable <- join_all(list(filtered_table,facilities_tabulated,sponsor,filter_dates,locations),by='nct_id',type="inner")
joinedTable_tabulated <- joinedTable %>% group_by(nct_id) %>% tally()
joinedTable_tabulated
facilities_tabulated
facilities
tail(facilities_tabulated)
sponsor %>% group_by(nct_id) %>% tally()
sponsor
sponsor <- sponsor_tbl %>% select(nct_id,agency_class,lead_or_collaborator) %>% filter(lead_or_collaborator == 'lead')%>% collect()
sponsor
sponsor %>% group_by(nct_id) %>% tally()
joinedTable <- join_all(list(filtered_table,facilities_tabulated,sponsor,filter_dates,locations),by='nct_id',type="inner")
joinedTable_tabulated <- joinedTable %>% group_by(nct_id) %>% tally()
joinedTable_tabulated
filtered_table %>% group_by(nct_id) %>% tally()
facilities_tabulated%>% group_by(nct_id) %>% tally()
facilities_tabulated
joinedTable_tabulated
joinedTable
a <- joinedTable %>% select(nct_id) %>% group_by(nct_id) %>% tally()
a
max(a$n)
joinedTable %>% mutate(diverse = str_detect(tolower(description), pattern = paste(strings, collapse = "|")))
as.integer(as.logical(joinedTable$diverse))
head(joinedTable)
joinedTable$diverse = as.integer(as.logical(joinedTable$diverse))
joinedTable %>% mutate(diverse = str_detect(tolower(description), pattern = paste(stringsBlack, collapse = "|")))
stringsBlack = c('black','african american')
stringHisp = ('hispanic')
joinedTable %>% mutate(diverse = str_detect(tolower(description), pattern = paste(stringsBlack, collapse = "|")))
joinedTable$diverseNum = as.integer(joinedTable$diverse)
joinedTable %>% mutate(diverse = as.numeric(str_detect(tolower(description), pattern = paste(stringsBlack, collapse = "|"))))
joinedTable %>% mutate(case_when(str_detect(tolower(description), pattern = paste(stringsBlack, collapse = "|")) ~ 1,
str_detect(tolower(description), pattern = paste(stringsBlack, collapse = "|"))~  2,
TRUE ~ 0))
joinedTable %>% mutate(diverse = case_when(str_detect(tolower(description), pattern = paste(stringsBlack, collapse = "|")) ~ 1,
str_detect(tolower(description), pattern = paste(stringsHisp, collapse = "|"))~  2,
TRUE ~ 0))
joinedTable %>% mutate(diverse = case_when(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|")) ~ 1,
str_detect(tolower(description), pattern = paste(stringHisp, collapse = "|"))~  2,
TRUE ~ 0))
stringBlack = c('black','african american')
stringHisp = ('hispanic')
joinedTable %>% mutate(diverse = case_when(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|")) ~ 1,
str_detect(tolower(description), pattern = paste(stringHisp, collapse = "|"))~  2,
TRUE ~ 0))
joinedTable %>% mutate(yearStart=year(joinedTable$start_date))
joindTableCount %>% group_by(yearStart,diverse) %>% count()
joinedTableCount <- joinedTable %>% group_by(yearStart,diverse) %>% count()
joinedTable %>% mutate(yearStart=year(joinedTable$start_date))
joinedTableCount <- joinedTable %>% group_by(yearStart,diverse) %>% count()
head(joinedTable)
joinedTable <- joinedTable %>% mutate(diverse = case_when(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|")) ~ 1,
str_detect(tolower(description), pattern = paste(stringHisp, collapse = "|"))~  2,
TRUE ~ 0))
joinedTable <- joinedTable %>% mutate(yearStart=year(joinedTable$start_date))
joinedTableCount <- joinedTable %>% group_by(yearStart,diverse) %>% count()
joinedTableCount
p<-ggplot(joinedTable, aes(x=yearStart,y=nn, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
#ggsave("trialsByYearConditionsTitle.png", units="in", width=5, height=4, dpi=600)
### scratch below
p<-ggplot(joinedTableCount, aes(x=yearStart,y=nn, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
#ggsave("trialsByYearConditionsTitle.png", units="in", width=5, height=4, dpi=600)
### scratch below
joinedTable <- joinedTable %>% mutate(diverse = case_when(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|")) ~ 'black',
str_detect(tolower(description), pattern = paste(stringHisp, collapse = "|"))~  'hispanic',
TRUE ~ 'not diverse'))
joinedTable <- joinedTable %>% mutate(yearStart=year(joinedTable$start_date))
joinedTableCount <- joinedTable %>% group_by(yearStart,diverse) %>% count()
p<-ggplot(joinedTableCount, aes(x=yearStart,y=nn, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
#ggsave("trialsByYearConditionsTitle.png", units="in", width=5, height=4, dpi=600)
### scratch below
setwd("C:/Users/david/SharedCode/aact")
stringBlack = c('black','african american')
stringHisp = c('hispanic','latino','latina')
joinedTable <- joinedTable %>% mutate(diverse = as.numeric(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|"))))
joinedTable <- joinedTable %>% mutate(diverse = case_when(str_detect(tolower(description), pattern = paste(stringBlack, collapse = "|")) ~ 'black',
str_detect(tolower(description), pattern = paste(stringHisp, collapse = "|"))~  'hispanic',
TRUE ~ 'not diverse'))
joinedTable <- joinedTable %>% mutate(yearStart=year(joinedTable$start_date))
joinedTableCount <- joinedTable %>% group_by(yearStart,diverse) %>% count()
p<-ggplot(joinedTableCount, aes(x=yearStart,y=nn, group=diverse, color=diverse)) +
geom_line()+
geom_point() +
labs(x = "year",y="count",title = "Number of Blood Pressure Trials Started Per Year") +
scale_y_continuous(breaks=seq(0,250,10)) +
scale_x_continuous(breaks=seq(2009,2019,1),limits=c(2009,2019))
print(p)
ggsave("trialsByYearConditionsHispBlack.png", units="in", width=5, height=4, dpi=600)
View(joinedTable)
write.csv(joinedTable,'htnTable_10_24_2019.csv')
colnames(joinedTable)
joinedTableSummarize %>% group_by(diverse,agency_class,phase) %>% count()
joinedTableSummarize <- joinedTable %>% group_by(diverse,agency_class,phase) %>% count()
joinedTableSummarize
write.csv(joinedTableSummarize,'htnTableSummarize_10_24_2019.csv')
